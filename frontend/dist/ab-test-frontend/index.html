<!doctype html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="utf-8">
  <title>Statistical Significance Testing Platform</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
        --primary-color: #1e40af;
        --primary-hover: #1d4ed8;
        --primary-light: #3b82f6;
        --secondary-color: #0f766e;
        --success-color: #059669;
        --warning-color: #d97706;
        --danger-color: #dc2626;
        --info-color: #0369a1;
        --accent-color: #7c3aed;
        --bg-primary: #fefefe;
        --bg-secondary: #f8fafc;
        --bg-accent: #f1f5f9;
        --text-primary: #1e293b;
        --text-secondary: #64748b;
        --text-muted: #94a3b8;
        --border-color: #e2e8f0;
        --border-light: #f1f5f9;
        --shadow-sm: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px 0 rgb(0 0 0 / 0.06);
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.06);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.05);
        --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 10px 10px -5px rgb(0 0 0 / 0.04);
        --border-radius: 12px;
        --border-radius-sm: 8px;
    }

    [data-bs-theme="dark"] {
        --bg-primary: #0f172a;
        --bg-secondary: #1e293b;
        --bg-accent: #334155;
        --text-primary: #f1f5f9;
        --text-secondary: #cbd5e1;
        --text-muted: #94a3b8;
        --border-color: #334155;
        --border-light: #475569;
        --shadow-sm: 0 1px 3px 0 rgb(0 0 0 / 0.3), 0 1px 2px 0 rgb(0 0 0 / 0.2);
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.4), 0 2px 4px -2px rgb(0 0 0 / 0.3);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.5), 0 4px 6px -4px rgb(0 0 0 / 0.4);
        --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.6), 0 10px 10px -5px rgb(0 0 0 / 0.5);
    }

    body {
        background-color: var(--bg-primary);
        color: var(--text-primary);
        font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        line-height: 1.6;
    }

    /* Hero section */
    .hero-section {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        border-radius: var(--border-radius);
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
    }

    .hero-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, rgba(255, 255, 255, 0.05) 0%, transparent 100%);
        pointer-events: none;
    }

    .hero-title {
        color: white;
        font-weight: 600;
        font-size: 2.75rem;
        letter-spacing: -0.025em;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    /* Cards */
    .card {
        background: linear-gradient(145deg, var(--bg-secondary) 0%, var(--bg-accent) 100%);
        border: 1px solid var(--border-light);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-md);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 2px;
        background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--accent-color));
    }

    .card:hover {
        box-shadow: var(--shadow-xl);
        transform: translateY(-2px);
    }

    /* Professional icon styling */
    .metric-icon {
        width: 48px;
        height: 48px;
        border-radius: var(--border-radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 0;
        font-size: 1.2rem;
        box-shadow: var(--shadow-sm);
        transition: all 0.3s ease;
    }

    .metric-icon.primary {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
        color: white;
    }

    .metric-icon.info {
        background: linear-gradient(135deg, var(--info-color), var(--secondary-color));
        color: white;
    }

    .metric-icon.accent {
        background: linear-gradient(135deg, var(--accent-color), #5b21b6);
        color: white;
    }

    /* Metric cards */
    .metric-card {
        background: linear-gradient(145deg, var(--bg-secondary) 0%, var(--bg-accent) 100%);
        border: 1px solid var(--border-light);
        border-radius: var(--border-radius);
        padding: 1.5rem;
        text-align: left;
        transition: all 0.3s ease;
        box-shadow: var(--shadow-sm);
        position: relative;
        overflow: hidden;
    }

    .metric-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        border-radius: 0 2px 2px 0;
    }

    .metric-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
        border-color: var(--primary-color);
    }

    /* Charts */
    .chart-container {
        background-color: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        padding: 1.5rem;
    }

    /* Animation */
    .fade-in {
        animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Responsive design */
    @media (max-width: 768px) {
        .hero-title {
            font-size: 2rem;
        }
        
        .hero-section {
            margin-bottom: 1rem;
        }
        
        .metric-card {
            margin-bottom: 1rem;
        }
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand" href="/">
        <i class="fas fa-chart-line me-2"></i>
        Statistical Testing Platform
      </a>
    </div>
  </nav>

  <main class="container my-5">
    <!-- Hero Section -->
    <div class="hero-section">
      <div class="card-body text-center py-5">
        <h1 class="hero-title mb-4">Statistical Significance Testing Platform</h1>
        <p class="lead mb-4" style="color: rgba(255, 255, 255, 0.9); font-size: 1.1rem;">
          Enterprise-grade A/B test analysis with comprehensive statistical metrics and confidence intervals
        </p>
        <div class="row text-center mt-4">
          <div class="col-md-4">
            <div class="d-flex align-items-center justify-content-center mb-2">
              <div class="metric-icon primary me-3">
                <i class="fas fa-chart-line"></i>
              </div>
              <span style="color: rgba(255, 255, 255, 0.9); font-weight: 500;">Statistical Testing</span>
            </div>
          </div>
          <div class="col-md-4">
            <div class="d-flex align-items-center justify-content-center mb-2">
              <div class="metric-icon info me-3">
                <i class="fas fa-chart-bar"></i>
              </div>
              <span style="color: rgba(255, 255, 255, 0.9); font-weight: 500;">Data Visualization</span>
            </div>
          </div>
          <div class="col-md-4">
            <div class="d-flex align-items-center justify-content-center mb-2">
              <div class="metric-icon accent me-3">
                <i class="fas fa-microscope"></i>
              </div>
              <span style="color: rgba(255, 255, 255, 0.9); font-weight: 500;">Research Analytics</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-6">
        <div class="card mb-4">
          <div class="card-header">
            <h3 class="card-title mb-0">
              <i class="fas fa-calculator me-2"></i>
              Test Data Input
            </h3>
          </div>
          <div class="card-body">
            <form id="ab-test-form">
              <div class="row">
                <div class="col-md-6">
                  <h5 class="mb-3">Control Group (A)</h5>
                  <div class="mb-3">
                    <label for="control-size" class="form-label">Sample Size</label>
                    <input type="number" id="control-size" name="control_size" class="form-control" min="1" required>
                    <div class="form-text">Total number of users in control group</div>
                  </div>
                  <div class="mb-3">
                    <label for="control-conversions" class="form-label">Conversions</label>
                    <input type="number" id="control-conversions" name="control_conversions" class="form-control" min="0" required>
                    <div class="form-text">Number of users who converted</div>
                  </div>
                </div>
                <div class="col-md-6">
                  <h5 class="mb-3">Variation Group (B)</h5>
                  <div class="mb-3">
                    <label for="variation-size" class="form-label">Sample Size</label>
                    <input type="number" id="variation-size" name="variation_size" class="form-control" min="1" required>
                    <div class="form-text">Total number of users in variation group</div>
                  </div>
                  <div class="mb-3">
                    <label for="variation-conversions" class="form-label">Conversions</label>
                    <input type="number" id="variation-conversions" name="variation_conversions" class="form-control" min="0" required>
                    <div class="form-text">Number of users who converted</div>
                  </div>
                </div>
              </div>
              
              <div class="d-grid">
                <button type="submit" class="btn btn-primary btn-lg">
                  <i class="fas fa-calculator me-2"></i>
                  Calculate Statistical Significance
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
      
      <div class="col-lg-6">
        <!-- Error Alert -->
        <div id="error-alert" class="alert alert-danger d-none" role="alert">
          <i class="fas fa-exclamation-triangle me-2"></i>
          <span id="error-message">An error occurred</span>
        </div>
        
        <!-- Loading Indicator -->
        <div id="loading-indicator" class="text-center d-none py-5">
          <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-3">Calculating statistical significance...</p>
        </div>
        
        <!-- Results Section -->
        <div id="results-section" class="d-none">
          <div class="card mb-4">
            <div class="card-header">
              <h3 class="card-title mb-0">
                <i class="fas fa-chart-bar me-2"></i>
                Statistical Results
              </h3>
            </div>
            <div class="card-body">
              <!-- Significance Status -->
              <div id="significance-status" class="alert mb-4" role="alert">
                <h4 class="alert-heading">
                  <i id="significance-icon" class="fas me-2"></i>
                  <span id="significance-title">Test Result</span>
                </h4>
                <p id="significance-message" class="mb-0">Statistical significance message</p>
              </div>
              
              <!-- Key Metrics -->
              <div class="row mb-4">
                <div class="col-md-6">
                  <div class="metric-card text-center">
                    <h6 class="text-muted mb-2">Control Rate</h6>
                    <div id="control-rate" class="display-4">-</div>
                    <small id="control-ci" class="text-muted">95% CI: -</small>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="metric-card text-center">
                    <h6 class="text-muted mb-2">Variation Rate</h6>
                    <div id="variation-rate" class="display-4">-</div>
                    <small id="variation-ci" class="text-muted">95% CI: -</small>
                  </div>
                </div>
              </div>
              
              <h5 class="mb-3">
                <i class="fas fa-chart-bar me-2"></i>
                Conversion Rate Comparison
              </h5>
              <div class="chart-container" style="height: 250px">
                <canvas id="conversion-chart"></canvas>
              </div>
              
              <div class="row mt-4">
                <div class="col-md-6">
                  <div class="metric-card mb-3">
                    <div class="d-flex align-items-center mb-3">
                      <div class="metric-icon info me-3">
                        <i class="fas fa-chart-line"></i>
                      </div>
                      <h5 class="mb-0">Difference Analysis</h5>
                    </div>
                    <div class="table-responsive">
                      <table class="table table-sm">
                        <tbody>
                          <tr>
                            <td>Absolute</td>
                            <td id="absolute-diff" class="text-end fw-bold">-</td>
                          </tr>
                          <tr>
                            <td>Relative</td>
                            <td id="relative-diff" class="text-end fw-bold">-</td>
                          </tr>
                          <tr>
                            <td>95% CI</td>
                            <td id="diff-ci" class="text-end fw-bold">-</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="metric-card mb-3">
                    <div class="d-flex align-items-center mb-3">
                      <div class="metric-icon primary me-3">
                        <i class="fas fa-flask"></i>
                      </div>
                      <h5 class="mb-0">Statistical Tests</h5>
                    </div>
                    <div class="table-responsive">
                      <table class="table table-sm">
                        <tbody>
                          <tr>
                            <td>Z-Score</td>
                            <td id="z-score" class="text-end fw-bold">-</td>
                          </tr>
                          <tr>
                            <td>P-Value</td>
                            <td id="p-value" class="text-end fw-bold">-</td>
                          </tr>
                          <tr>
                            <td>Effect Size</td>
                            <td id="effect-size" class="text-end fw-bold">-</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
              
              <div id="sample-size-recommendation" class="d-none mt-3 alert alert-info">
                <!-- Will be populated with JS if needed -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Statistical Concepts -->
    <div class="row mt-5">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title mb-0">
              <i class="fas fa-book me-2"></i>
              Understanding Statistical Concepts
            </h3>
          </div>
          <div class="card-body">
            <div class="accordion" id="concepts-accordion">
              <div class="accordion-item">
                <h2 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#statistical-significance">
                    Statistical Significance
                  </button>
                </h2>
                <div id="statistical-significance" class="accordion-collapse collapse" data-bs-parent="#concepts-accordion">
                  <div class="accordion-body">
                    <p>Statistical significance indicates whether the observed difference between groups is likely due to a real effect rather than random chance. A result is typically considered statistically significant when p ≤ 0.05.</p>
                    <ul>
                      <li><strong>P-value:</strong> The probability of observing the results if there was no real difference</li>
                      <li><strong>Confidence Level:</strong> Usually 95%, meaning we're 95% confident in our results</li>
                      <li><strong>Type I Error:</strong> Falsely concluding there's a difference when there isn't</li>
                    </ul>
                  </div>
                </div>
              </div>
              
              <div class="accordion-item">
                <h2 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#confidence-intervals">
                    Confidence Intervals
                  </button>
                </h2>
                <div id="confidence-intervals" class="accordion-collapse collapse" data-bs-parent="#concepts-accordion">
                  <div class="accordion-body">
                    <p>Confidence intervals provide a range of values that likely contain the true conversion rate. A 95% confidence interval means that if we repeated the test 100 times, 95 intervals would contain the true value.</p>
                    <ul>
                      <li><strong>Narrow intervals:</strong> More precise estimates (larger sample sizes)</li>
                      <li><strong>Wide intervals:</strong> Less precise estimates (smaller sample sizes)</li>
                      <li><strong>Overlapping intervals:</strong> May suggest no significant difference</li>
                    </ul>
                  </div>
                </div>
              </div>
              
              <div class="accordion-item">
                <h2 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#effect-size">
                    Effect Size
                  </button>
                </h2>
                <div id="effect-size" class="accordion-collapse collapse" data-bs-parent="#concepts-accordion">
                  <div class="accordion-body">
                    <p>Effect size measures the practical significance of your results - how big the difference actually is, regardless of statistical significance.</p>
                    <ul>
                      <li><strong>Cohen's h < 0.2:</strong> Small effect</li>
                      <li><strong>Cohen's h ≈ 0.5:</strong> Medium effect</li>
                      <li><strong>Cohen's h ≥ 0.8:</strong> Large effect</li>
                    </ul>
                    <p>A statistically significant result with a small effect size may not be practically meaningful for business decisions.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- JavaScript functionality -->
  <script>
    // Format percentage values
    function formatPercent(value, decimals = 1) {
        return (value * 100).toFixed(decimals) + '%';
    }

    // Format p-values for display
    function formatPValue(pValue) {
        if (pValue < 0.001) {
            return 'p < 0.001';
        } else if (pValue < 0.01) {
            return 'p < 0.01';
        } else {
            return 'p = ' + pValue.toFixed(3);
        }
    }

    // Update conversion chart
    function updateConversionChart(controlData, variationData) {
        const ctx = document.getElementById('conversion-chart').getContext('2d');
        
        // Destroy existing chart if it exists
        if (window.conversionChart) {
            window.conversionChart.destroy();
        }
        
        window.conversionChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Control (A)', 'Variation (B)'],
                datasets: [{
                    label: 'Conversion Rate',
                    data: [controlData.conversion_rate * 100, variationData.conversion_rate * 100],
                    backgroundColor: [
                        'rgba(30, 64, 175, 0.8)',
                        'rgba(15, 118, 110, 0.8)'
                    ],
                    borderColor: [
                        'rgb(30, 64, 175)',
                        'rgb(15, 118, 110)'
                    ],
                    borderWidth: 2,
                    borderRadius: 8,
                    borderSkipped: false,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ' + context.parsed.y.toFixed(2) + '%';
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Conversion Rate (%)'
                        },
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Test Groups'
                        }
                    }
                }
            }
        });
    }

    // Show error message
    function showError(message) {
        const errorAlert = document.getElementById('error-alert');
        const errorMessage = document.getElementById('error-message');
        errorMessage.textContent = message;
        errorAlert.classList.remove('d-none');
    }

    // Display test results
    function displayResults(results) {
        // Show results section with animation
        const resultsSection = document.getElementById('results-section');
        resultsSection.classList.remove('d-none');
        resultsSection.classList.add('fade-in');
        
        // Basic results
        document.getElementById('control-rate').textContent = formatPercent(results.control.conversion_rate, 2);
        document.getElementById('variation-rate').textContent = formatPercent(results.variation.conversion_rate, 2);
        
        // Confidence intervals
        document.getElementById('control-ci').textContent = `95% CI: [${formatPercent(results.control.ci_lower, 2)} - ${formatPercent(results.control.ci_upper, 2)}]`;
        document.getElementById('variation-ci').textContent = `95% CI: [${formatPercent(results.variation.ci_lower, 2)} - ${formatPercent(results.variation.ci_upper, 2)}]`;
        
        // Difference analysis
        document.getElementById('absolute-diff').textContent = formatPercent(results.difference.absolute, 2);
        document.getElementById('relative-diff').textContent = results.difference.relative.toFixed(1) + '%';
        document.getElementById('diff-ci').textContent = `[${formatPercent(results.difference.ci_lower, 2)} - ${formatPercent(results.difference.ci_upper, 2)}]`;
        
        // Statistical tests
        document.getElementById('z-score').textContent = results.statistical_tests.z_test.z_score.toFixed(3);
        document.getElementById('p-value').textContent = formatPValue(results.statistical_tests.z_test.p_value);
        document.getElementById('effect-size').textContent = `${results.effect_size.cohens_h.toFixed(3)} (${results.effect_size.interpretation})`;
        
        // Significance status
        const statusElement = document.getElementById('significance-status');
        const iconElement = document.getElementById('significance-icon');
        const titleElement = document.getElementById('significance-title');
        const messageElement = document.getElementById('significance-message');
        
        if (results.results.is_significant) {
            statusElement.className = 'alert alert-success mb-4';
            iconElement.className = 'fas fa-check-circle me-2';
            titleElement.textContent = 'Statistically Significant';
            messageElement.textContent = `The difference between groups is statistically significant (p ≤ 0.05). The variation shows a ${Math.abs(results.difference.relative).toFixed(1)}% ${results.difference.relative > 0 ? 'increase' : 'decrease'} in conversion rate.`;
        } else {
            statusElement.className = 'alert alert-warning mb-4';
            iconElement.className = 'fas fa-exclamation-triangle me-2';
            titleElement.textContent = 'Not Statistically Significant';
            messageElement.textContent = `The difference between groups is not statistically significant (p > 0.05). Consider running the test longer or with larger sample sizes.`;
            
            // Show sample size recommendation
            const recommendationElement = document.getElementById('sample-size-recommendation');
            recommendationElement.innerHTML = `
                <h5 class="alert-heading">
                    <i class="fas fa-lightbulb me-2"></i>
                    Sample Size Recommendation
                </h5>
                <p class="mb-0">
                    To detect this effect size with 80% power, consider testing with approximately 
                    <strong>${results.results.recommended_sample_size.toLocaleString()}</strong> users per group.
                </p>
            `;
            recommendationElement.classList.remove('d-none');
        }
        
        // Update chart
        updateConversionChart(results.control, results.variation);
    }

    // Form submission handler
    document.getElementById('ab-test-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Hide previous results and errors
        document.getElementById('results-section').classList.add('d-none');
        document.getElementById('error-alert').classList.add('d-none');
        document.getElementById('sample-size-recommendation').classList.add('d-none');
        
        // Show loading indicator
        document.getElementById('loading-indicator').classList.remove('d-none');
        
        // Get form data
        const formData = new FormData(this);
        const data = {
            control_size: parseInt(formData.get('control_size')),
            control_conversions: parseInt(formData.get('control_conversions')),
            variation_size: parseInt(formData.get('variation_size')),
            variation_conversions: parseInt(formData.get('variation_conversions'))
        };
        
        // Validate data
        if (data.control_conversions > data.control_size) {
            document.getElementById('loading-indicator').classList.add('d-none');
            showError('Control conversions cannot be greater than control sample size.');
            return;
        }
        
        if (data.variation_conversions > data.variation_size) {
            document.getElementById('loading-indicator').classList.add('d-none');
            showError('Variation conversions cannot be greater than variation sample size.');
            return;
        }
        
        try {
            // Send request to API
            const response = await fetch('/api/calculate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });
            
            const result = await response.json();
            
            // Hide loading indicator
            document.getElementById('loading-indicator').classList.add('d-none');
            
            if (response.ok) {
                displayResults(result);
            } else {
                showError(result.error || 'An error occurred while calculating results.');
            }
        } catch (error) {
            // Hide loading indicator
            document.getElementById('loading-indicator').classList.add('d-none');
            showError('Network error: Unable to calculate results. Please try again.');
            console.error('Error:', error);
        }
    });
  </script>
</body>
</html>